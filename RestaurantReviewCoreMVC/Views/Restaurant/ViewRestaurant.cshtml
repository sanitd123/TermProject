@model RestaurantReviewCoreMVC.Models.Restaurant
@inject IHttpContextAccessor HttpContextAccessor
<h>Restaurant Details</h>
<style>
    .dashboard-container {
    position: fixed;
    top: 10px;
    right: 10px;
    z-index: 1000;
    }
</style>
@{
    string accType = Context.Session.GetString("AccountType");
}
<div>

    Title:
    @Model.Title
    <br />
    Description:
    @Model.Description
    <br />
    Average Score:
    @Model.AvgScore
    <br />
    Cuisine:
    @Model.Cuisine
    <br />
    Street:
    @Model.Street
    <br />
    City:
    @Model.City
    <br />
    State:
    @Model.State
    <br />
    Zipcode:
    @Model.Zipcode
    <br />
    Phone:
    @Model.Phone
    <br />
    Email:
    @Model.Email
    <br />
    Website:
    @Model.Website
    <br />
    Hours:
    @Model.Hours
    <br />
    Owner:
    @Model.Owner
</div>

<h3>Reviews</h3>
<div style="display: flex; flex-direction: column;">
    @foreach (Review review in Model.ReviewList)
    {
        
        double avgScore = (review.Quality + review.Atmosphere + review.Price + review.Service) / 4.0;
        
        <div style="display: flex; flex-direction: row; align-items: flex-start; margin-bottom: 10px;">
            <div style="margin-right: 20px;">
                <strong>Name:</strong> @review.Name
            </div>
            <div style="margin-right: 20px;">
                <strong>Comment:</strong> @review.Comment
            </div>
            <div style="margin-right: 20px;">
                <strong>Average Score:</strong> @avgScore
            </div>
            <div>
                <strong>Time:</strong> @review.VisitTime
            </div>
            <div>
                <a asp-controller="Restaurant" asp-action="Review" asp-route-id="@review.ReviewID">View Review</a>
            </div>
        </div>
    }
</div>

<div class="d-flex justify-content-end gap-2">
    @if (accType.Equals("Reviewer"))
    {
        <form asp-controller="Restaurant" asp-action="Review" method="get">
            <input type="hidden" name="restaurantID" value="@Model.RestaurantID" />
            <button type="submit" class="btn btn-primary">Write a Review</button>
        </form>
    }
    <form asp-controller="Restaurant" asp-action="Reservation" method="get">
        <input type="hidden" name="restaurantID" value="@Model.RestaurantID" />
        <button type="submit" class="btn btn-primary">Make a Reservation</button>
    </form>
    <a class="btn btn-primary" asp-action="SearchRestaurant" asp-controller="Restaurant">Back to Search</a>
</div>

<div id="map" style="height: 400px"></div>

@*
    script uses leaflet.js library to render a map, openstreetmap api is called to give data to leaflet
    reference: https://leafletjs.com/
*@
<script>
    var lat = @Model.Coordinate.lat.ToString(System.Globalization.CultureInfo.InvariantCulture);
    var lon = @Model.Coordinate.lon.ToString(System.Globalization.CultureInfo.InvariantCulture);

    var map = L.map('map').setView([lat, lon], 15);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    L.marker([lat, lon]).addTo(map); // No popup
</script>